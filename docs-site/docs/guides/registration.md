---
title: Регистрация и вход
description: Как зарегистрироваться и войти в Ren с использованием E2EE
sidebar_position: 1
---

# Регистрация и вход

## Регистрация нового пользователя

### Шаг 1: Откройте приложение

Запустите Flutter приложение или откроите веб-интерфейс.

### Шаг 2: Заполните форму регистрации

Введите следующие данные:

| Поле | Требования | Пример |
|------|------------|--------|
| **Логин** | Уникальный, используется для входа | `john_doe` |
| **Username** | Уникальный, отображается в чатах | `john` |
| **Nickname** | Опционально, отображаемое имя (макс. 32 символа) | `John Doe` |
| **Пароль** | Минимум 6 символов | `********` |
| **Аватар** | Опционально, изображение | `avatar.jpg` |

### Шаг 3: E2EE настройка

Приложение автоматически сгенерирует:

1. **Пару ключей X25519** — для шифрования сообщений
2. **Мастер-ключ** — деривируется из пароля через PBKDF2-HMAC-SHA256 (100,000 итераций)
3. **Ключ восстановления** — 12-словная мнемоническая фраза (128 бит энтропии)

### Шаг 4: Сохраните ключ восстановления

> **Важно:** Ключ восстановления используется для восстановления доступа при потере пароля. Сервер не хранит ваш пароль и не может восстановить доступ.

Запишите или сохраните ключ восстановления в надёжном месте.

### Шаг 5: Завершение регистрации

Нажмите «Зарегистрироваться». Приложение:

1. Зашифрует приватный ключ двумя способами:
   - `pkebymk` — мастер-ключом (для обычного доступа)
   - `pkebyrk` — ключом восстановления (для восстановления доступа)
2. Отправит публичный ключ и зашифрованные данные на сервер
3. Сохранит JWT токен в защищённом хранилище

## Вход

### Шаг 1: Введите учётные данные

| Поле | Описание |
|------|----------|
| **Логин** | Ваш логин при регистрации |
| **Пароль** | Ваш пароль |

### Шаг 2: E2EE верификация

Приложение:

1. Деривирует мастер-ключ из пароля
2. Расшифровывает приватный ключ (`pkebymk`)
3. Выполняет self-check через wrap/unwrap
4. Получает JWT токен от сервера

### Шаг 3: Успешный вход

Токен сохраняется в `flutter_secure_storage` (Keychain на iOS, Keystore на Android).

## Восстановление доступа

Если вы забыли пароль:

### Шаг 1: Откройте экран восстановления

Нажмите «Забыли пароль?» на экране входа.

### Шаг 2: Введите ключ восстановления

Введите 12-словную мнемоническую фразу.

### Шаг 3: Введите новый пароль

Приложение:

1. Деривирует ключ восстановления из фразы через Argon2id
2. Расшифровывает приватный ключ (`pkebyrk`)
3. Позволяет установить новый пароль
4. Перешифровывает приватный ключ новым мастер-ключом

## Безопасность

### Хранение ключей

| Ключ | Где хранится | Шифрование |
|------|--------------|------------|
| **JWT токен** | flutter_secure_storage | OS-level (Keychain/Keystore) |
| **Приватный ключ** | flutter_secure_storage | Расшифровывается при входе |
| **Публичный ключ** | flutter_secure_storage | Plaintext |
| **Ключ восстановления** | Не хранится | Только у пользователя |

### Рекомендации

1. **Используйте сложный пароль** — минимум 10 символов, буквы + цифры
2. **Сохраните ключ восстановления** — в надёжном месте (менеджер паролей, бумага)
3. **Не передавайте ключ восстановления** — никто не должен его знать
4. **Включите защиту от скриншотов** — через `--dart-define=REN_ANDROID_FLAG_SECURE=true`

## Проблемы и решения

### «Неверный логин или пароль»

**Причина:** Неправильный пароль или логин.

**Решение:** Проверьте раскладку клавиатуры и регистр символов.

### «Ключ восстановления не подходит»

**Причина:** Неправильно введённая фраза.

**Решение:** Проверьте каждое слово. Фраза чувствительна к порядку.

### «Self-check не прошёл»

**Причина:** Приватный ключ не соответствует публичному.

**Решение:** Попробуйте восстановить доступ через ключ восстановления.
