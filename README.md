# Ren

**Self-hosted мессенджер с端到-end шифрованием**

Приватный мессенджер, который вы контролируете полностью. Развёртывайте на своём сервере, храните данные у себя, общайтесь без посредников.

---

## 🚀 Быстрый старт

### Запуск бэкенда
```bash
cd backend
cp .env.example .env
cargo run
```

**Необходимые переменные:**
- `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_HOST`, `POSTGRES_PORT`, `POSTGRES_DB`
- `JWT_SECRET`

### Запуск приложения
```bash
cd apps/flutter
flutter pub get
flutter run
```

---

## 📦 Архитектура проекта

```
┌─────────────────────────────────────────────────────────┐
│                    Клиенты                              │
│  ┌─────────────┐              ┌─────────────┐          │
│  │   Flutter   │              │    React    │          │
│  │ iOS/Android │              │    Web      │          │
│  └──────┬──────┘              └──────┬──────┘          │
└─────────┼────────────────────────────┼─────────────────┘
          │         ┌──────────────────┘
          │         │  ┌──────────────┐
          └─────────┼──►   Ren-SDK    │
                    │  │   (Rust)     │
                    │  └──────────────┘
                    │
          ┌─────────┴──────────┐
          │   Бэкенд (Axum)    │
          │  HTTP + WebSocket  │
          └─────────┬──────────┘
                    │
        ┌───────────┴───────────┐
        │                       │
   ┌────▼────┐            ┌────▼────┐
   │PostgreSQL│            │ Файлы   │
   │ База    │            │uploads/ │
   └─────────┘            └─────────┘
```

### Компоненты

| Компонент | Путь | Технологии |
|-----------|------|------------|
| **Мобильное приложение** | `apps/flutter` | Flutter/Dart |
| **Веб-клиент** | `frontend` | React |
| **Криптография** | `Ren-SDK` | Rust (FFI/WASM) |
| **Сервер** | `backend` | Axum + PostgreSQL |

---

## 🔐 Безопасность

### Шифрование

| Тип чата | E2EE |
|----------|------|
| Личные 1:1 | ✅ **Да** |
| Групповые | ❌ Нет |
| Каналы | ❌ Нет |

### Криптографические примитивы

- **X25519 ECDH** — согласование ключей
- **ChaCha20-Poly1305** — шифрование сообщений и файлов
- **HKDF-SHA256** — деривация ключей
- **PBKDF2-HMAC-SHA256** (100K итераций) — ключ из пароля
- **Argon2id** — хеширование паролей на сервере

### Как работает шифрование (1:1)

```
Отправитель                    Получатель
     │                              │
     │  1. Генерация ключа          │
     │  2. Шифрование сообщения     │
     │  3. Упаковка ключа           │
     │     (конверты для каждого)   │
     │                              │
     └────────► Бэкенд ◄────────────┘
                (хранит             │
                 зашифрованные      │
                 данные)            │
                                    │
     ◄──────────────────────────────┘
        4. Распаковка ключа
        5. Расшифровка сообщения
```

### Хранение ключей

Ключи хранятся в защищённом хранилище устройства:
- **iOS:** Keychain
- **Android:** Keystore

Что сохраняется:
- Приватный/публичный ключ
- Токены доступа
- ID сессии

---

## ⚠️ Ограничения

- Групповые чаты и каналы **не шифруются** E2EE
- Нет Double Ratchet (ограниченная прямая секретность)
- Метаданные (отправитель, получатель, время) не шифруются

---

## 🛡️ Правила безопасности

**Никогда не коммитьте:**
- Приватные ключи
- JWT_SECRET
- API-токены
- Пароли от БД

Используйте менеджеры секретов в CI/CD.

---

## 📄 Лицензия

[Укажите лицензию здесь]
